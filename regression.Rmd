---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r}
# install.packages("wooldridge")
# install.packages("dpylr")
# install.packages("lmtest")
# install.packages("regclass")
# install.packages("tidyverse")
# install.packages("gclus")
# install.packages("crayon")

library(wooldridge)
library(dplyr)
library(lmtest)
library(regclass)
library(tidyverse)
library(gclus)
library(crayon)
```


```{r}
data('bwght')

bw <- read.csv("C:/Users/angro/Desktop/AY 2020-2021/Year 3 Semester 2/MH3511 Data Analysis with Computer/Project/cleanedData.csv", header = TRUE)

head(bw)
```


```{r}
# removing all the variables that we will not be using in our data analysis
cleanedData <- select(bw, -c("packs", "bwghtlbs", "lbwght", "lfaminc", "cigtax", "cigprice")) 

 # Male is a categorical variable that takes on the value 1 when the child born is Male
cleanedData$male = as.factor(cleanedData$male) 

# White is a categorical variable that takes on the value of 1 when the child born is White
cleanedData$white = as.factor(cleanedData$white)

# Changing the birth weight of the baby(in grams) into a numerical data type
cleanedData$bwght = as.numeric(cleanedData$bwght)  

# Changing the family income of the baby's family into numerical data type
cleanedData$faminc = as.numeric(cleanedData$faminc)    

# Omitting all the NA values present in our data
cleanedData = na.omit(cleanedData)     

# Create new factor variable 'smoker' takes on the value 1 when the child's mother is a smoker
cleanedData$smoker = ifelse(cleanedData$cigs==0, 0, 
                            ifelse(cleanedData$cigs<10, 1, 
                                   ifelse(cleanedData$cigs<25, 2, 3)))
cleanedData$smoker = as.factor(cleanedData$smoker)

str(cleanedData)
head(cleanedData)
```

## Scatter Plot Matrix for Numerical Variables

```{r}
# Make a correlation scatter plot with lowess lines
categoricalVariables = c('male', 'white')
correlationData = select(cleanedData, -all_of(categoricalVariables))

# Make panels for correlation coefficients
panel.cor <- function(x, y){
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- round(cor(x, y), 2)
    txt <- paste0("r = ", r)
    if (r >= 0.5 | r<= -0.5) {text(0.5, 0.5, txt, cex = 1, col="red")}
    else {text(0.5, 0.5, txt, cex = 1, col="blue")}
    
}

# Generate the scatter plot matrix    
pairs(~bwght + faminc + fatheduc + motheduc + cigs,
      data=correlationData, 
      upper.panel = panel.smooth,
      lower.panel = panel.cor)
```

## Two-Sample Welch T-Tests for Categorical Variables 'male' and 'white'

```{r}
# Boxplots of variables 'male' and 'white'
boxplot(bwght~male, data = cleanedData, cex.main=0.7, names=c('Female', 'Male'))
boxplot(bwght~white, data = cleanedData, cex.main=0.7, names=c('Non-white', 'White'))

# Normality test for the sample of female birth weights
shapiro.test(cleanedData$bwght[cleanedData$male==0])

# Normality test for the sample of male birth weights
shapiro.test(cleanedData$bwght[cleanedData$male==1])

# Comparison of variances of male and female birth weights
var.test(cleanedData$bwght ~ cleanedData$male)

# Comparison of means of male and female birth weights
t.test(cleanedData$bwght ~ cleanedData$male, var.equal=TRUE)

# Normality test for the sample of non-white birth weights
shapiro.test(cleanedData$bwght[cleanedData$white==0])

# Normality test for the sample of white birth weights
shapiro.test(cleanedData$bwght[cleanedData$white==1])

# Comparison of variances of white and non-white birth weights
var.test(cleanedData$bwght ~ cleanedData$white)

# Comparison of means of white and non-white birth weights
t.test(cleanedData$bwght ~ cleanedData$white, var.equal=TRUE)
```

## One-Way ANOVA Test for Categorical Variable 'parity'

```{r}
# View unique values in variable 'parity'
sort(unique(cleanedData$parity), decreasing=FALSE)

# Box plot for birth weights across different birth orders
boxplot(cleanedData$bwght~cleanedData$parity)

# One-way ANOVA for birth weight against birth order
parity.aov = aov(cleanedData$bwght ~ cleanedData$parity)
summary(parity.aov)

# Pairwise comparisons for birth weight against birth order
pairwise.t.test(cleanedData$bwght, cleanedData$parity, p.adjust.method = "none")

# Box plot for birth weights across different degrees of smoking during pregnancy
boxplot(cleanedData$bwght~cleanedData$smoker)

# One-way ANOVA for birth weight against different degrees of smoking during pregnancy
parity.aov = aov(cleanedData$bwght ~ cleanedData$smoker)
summary(parity.aov)

# Pairwise comparisons for birth weight against different degrees of smoking during pregnancy
pairwise.t.test(cleanedData$bwght, cleanedData$smoker, p.adjust.method = "none")
```

## Simple Linear Regression Models for Numerical Variables

```{r}
# SLR Model between birth weight and family income 
linReg.faminc <- lm(bwght~faminc, data=cleanedData)
summary(linReg.faminc)

# Residual plot for family income
res.faminc<-linReg.faminc$res 
plot(cleanedData$faminc, residual)
abline(0,0)

# Residual QQ-plot for family income
qqnorm(resid(linReg.faminc), main = "")
qqline(resid(linReg.faminc), col='red')

# SLR Model between birth weight and number of years of father's education 
linReg.fatheduc<- lm(bwght~fatheduc, data=cleanedData)
summary(linReg.fatheduc)

# Residual plot for number of years of father's education
res.fatheduc<-linReg.fatheduc$res 
plot(cleanedData$fatheduc, residual)
abline(0,0)

# Residual QQ-plot for number of years of father's education
qqnorm(resid(linReg.fatheduc), main = "")
qqline(resid(linReg.fatheduc), col='red')

# SLR Model between birth weight and number of years of mother's education 
linReg.motheduc <- lm(bwght~motheduc, data=cleanedData)
summary(linReg.motheduc)

# Residual plot for number of years of mother's education
res.motheduc<-linReg.motheduc$res 
plot(cleanedData$motheduc, residual)
abline(0,0)

# Residual QQ-plot for number of years of mother's education
qqnorm(resid(linReg.motheduc), main = "")
qqline(resid(linReg.motheduc), col='red')

```

## Multiple Linear Regression for Numerical Variables

```{r}
# Full MLR model with all numerical variables
MLR <- lm(bwght~faminc+fatheduc+motheduc, data=cleanedData)
summary(MLR)

# Stepwise Feature Selection
step(MLR, direction="backward")

# Reduced MLR model
MLR.reduced <- lm(bwght~faminc+fatheduc, data=cleanedData)
summary(MLR.reduced)

par(mfrow=c(2,2))
plot(fitted(MLR.reduced), residuals(MLR.reduced), ylab='Residuals', xlab='Fitted Values')
plot(cleanedData$faminc, residuals(MLR.reduced), ylab='Residuals', xlab='X1')
plot(cleanedData$fatheduc, residuals(MLR.reduced), ylab='Residuals', xlab='X2')

# # Reduced MLR model 1 (with interaction effects)
# MLR.reduced1 <- lm(bwght~faminc+fatheduc+faminc*fatheduc, data=cleanedData)
# summary(MLR.reduced1)
# 
# par(mfrow=c(1,2))
# plot(fitted(MLR.reduced1), residuals(MLR.reduced1), ylab='Residuals', xlab='Fitted Values')
# plot(cleanedData$faminc*cleanedData$fatheduc, residuals(MLR.reduced1), ylab='Residuals', xlab='X1X2')
```

## Checking for Variance Inflation Factor and Heteroscedasticity

```{r}
# Tests for VIF and Heteroskedasticity

VIF(MLR.reduced)    # Checking if there exists a high degree of multicollinearity in our data
bptest(MLR.reduced) # Utilising the Breush-Pagan test to test for the presence of Homoscedasticity in our data
```
