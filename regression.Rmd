---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r}
# install.packages("wooldridge")
# install.packages("dpylr")
# install.packages("lmtest")
# install.packages("regclass")
# install.packages("tidyverse")
# install.packages("gclus")
# install.packages("crayon")

library(wooldridge)
library(dplyr)
library(lmtest)
library(regclass)
library(tidyverse)
library(gclus)
library(crayon)
```


```{r}
data('bwght')

bw <- na.omit(bwght)
bw
```


```{r}
head(bw)
```


```{r}
# removing all the variables that we will not be using in our data analysis
cleanedData <- select(bw, -c("packs", "bwghtlbs", "lbwght", "lfaminc", "cigtax", "cigprice")) 

 # Male is a categorical variable that takes on the value 1 when the child born is Male
cleanedData$male = as.factor(cleanedData$male) 

# White is a categorical variable that takes on the value of 1 when the child born is White
cleanedData$white = as.factor(cleanedData$white)

# Changing the birth weight of the baby(in grams) into a numerical data type
cleanedData$bwght = as.numeric(cleanedData$bwght)  

# Changing the family income of the baby's family into numerical data type
cleanedData$faminc = as.numeric(cleanedData$faminc)    

# Omitting all the NA values present in our data
cleanedData = na.omit(cleanedData)                    

str(cleanedData)
head(cleanedData)
```

## Scatter Plot Matrix for Numerical Variables

```{r}
# Make a correlation scatter plot with lowess lines
categoricalVariables = c('male', 'white')
correlationData = select(cleanedData, -all_of(categoricalVariables))

# Make panels for correlation coefficients
panel.cor <- function(x, y){
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- round(cor(x, y), digits=2)
    txt <- paste0("r = ", r)
    if (r >= 0.5 | r<= -0.5) {text(0.5, 0.5, txt, cex = 1, col="red")}
    else {text(0.5, 0.5, txt, cex = 1, col="blue")}
    
}

# Generate the scatter plot matrix    
pairs(~bwght + faminc + fatheduc + motheduc + parity + cigs,
      data=correlationData, 
      upper.panel = panel.smooth,
      lower.panel = panel.cor)
```

## Two-Sample Welch T-Tests for Categorical Variables 'male' and 'white'

```{r}
# Boxplots of variables 'male' and 'white'
boxplot(bwght~male, data = cleanedData, cex.main=0.7, names=c('Female', 'Male'))
boxplot(bwght~white, data = cleanedData, cex.main=0.7, names=c('Non-white', 'White'))

# Normality Test for the Sample of Female Birth Weights
shapiro.test(cleanedData$bwght[cleanedData$male==0])

# Normality Test for the Sample of Male Birth Weights
shapiro.test(cleanedData$bwght[cleanedData$male==1])

# Comparison of Variances of Male and Female Birth Weights
var.test(cleanedData$bwght ~ cleanedData$male)

# Comparison of Means of Male and Female Birth Weights
t.test(cleanedData$bwght ~ cleanedData$male, var.equal=TRUE)

# Normality Test for the Sample of Non-White Birth Weights
shapiro.test(cleanedData$bwght[cleanedData$white==0])

# Normality Test for the Sample of White Birth Weights
shapiro.test(cleanedData$bwght[cleanedData$white==1])

# Comparison of Variances of White and Non-White Birth Weights
var.test(cleanedData$bwght ~ cleanedData$white)

# Comparison of Means of White and Non-White Birth Weights
t.test(cleanedData$bwght ~ cleanedData$white, var.equal=TRUE)
```

## One-Way ANOVA Test for Categorical Variable 'parity'

```{r}
# View unique values in variable 'parity'
sort(unique(cleanedData$parity), decreasing=FALSE)

boxplot(bwght~parity, data = cleanedData)

parity.aov = aov(bwght ~ parity, data=cleanedData)
summary(parity.aov)
```

## Conducting Simple Linear Regression for all the Independent Variables

```{r}
# Conduct simple regression models for all remaining variables, this allows us to observe the relationship between all the variables and the bwght 

SLRObjects = lapply( select(cleanedData, -c('bwght')), function(x) lm(cleanedData$bwght ~ x))

```

## Conducting Multiple Linear Regression

```{r}
# Conduct Multiple Linear Regression with all variables

linearRegression <- lm(bwght~., data=cleanedData)
summary(linearRegression)

```
## Checking for Variance Inflation Factor and Heteroskedasticity
```{r}
# Check for VIF and Heteroskedasticity

bptest(linearRegression) # Utilizing th Breush-Pagan test to test for the presence of Homoskedasticity in our data
VIF(linearRegression)    # Checking if there exists a high degree of multicollinearity in our data

# From the results of the two tests, we can conclude that we can safely assume that Heteroskedasticity is not present in our data and
# There does not exist high multicollinearity in our data. Hence the standard errors and slope parameters derived from the MLR above can be assumed to be correct
```
## QQ-plots of all the Regressions run

```{r, fig.width=5, fig.height=25}
# Make qq plots of all residuals for all the regressions conducted
par(mfrow=c(7,1))

qqnorm(resid(SLRObjects$faminc), main = 'Residual QQ-plot for Family Income')
qqline(resid(SLRObjects$faminc), col='red')

qqnorm(resid(SLRObjects$fatheduc), main = 'Residual QQ-plot for Father Education')
qqline(resid(SLRObjects$fatheduc), col='red')

qqnorm(resid(SLRObjects$motheduc), main = 'Residual QQ-plot for Mother Education')
qqline(resid(SLRObjects$motheduc), col='red')

qqnorm(resid(SLRObjects$parity), main = 'Residual QQ-plot for Parity')
qqline(resid(SLRObjects$parity), col='red')

qqnorm(resid(SLRObjects$male), main = 'Residual QQ-plot for Male')
qqline(resid(SLRObjects$male), col='red')

qqnorm(resid(SLRObjects$white), main = 'Residual QQ-plot for White')
qqline(resid(SLRObjects$white), col='red')

qqnorm(resid(SLRObjects$cigs), main = 'Residual QQ-plot for Cigs')
qqline(resid(SLRObjects$cigs), col='red')

# Almost all the residuals have fat lower tails and there exist a single data point on the upper tail that can be considered to be an outlier

```
```{r}
qqnorm(resid(linearRegression), main = 'Residual QQ-plot for MLR')
qqline(resid(linearRegression), col='red')
```

## Explain Beta Coefficients for all the regressions

when the family income increases by 1 unit then, on average, the birth weight of the baby increases by 0.08965 grams, ceteris paribus

when the father's education increases by 1 unit then, on average, the birth weight of the baby increases by 0.6102 grams, ceteris paribus

when the mother's education increases by 1 unit then, on average, the birth weight of the baby increases by 0.3755 grams, ceteris paribus

when the number of children already born increases by 1 unit then, on average, the birth weight of the baby increases by 1.601 grams, ceteris paribus

when the child's sex is male, on average, the birth weight of the baby increases by 3.759 grams, ceteris paribus

when the child's race is white then, on average, the birth weight of the baby increases by 4.865 grams, ceteris paribus

when the number of cigs smoked by the mother while pregnant increases by 1 unit then, on average, the birth weight of the baby increases by -0.6203 grams, ceteris paribus

```

